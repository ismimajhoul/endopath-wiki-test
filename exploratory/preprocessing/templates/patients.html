<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>Correction de Tokens par exemple – Liste des patientes</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      .container { max-width: 900px; margin: 0 auto; }
      a { text-decoration: none; color: #005bbb; }
      a:hover { text-decoration: underline; }
      .num-list { border: 1px solid #ddd; padding: 10px; max-height: 400px; overflow-y: auto; }
      .header { display: flex; justify-content: space-between; align-items: baseline; }
      .username { font-size: 13px; color: #555; }

      .row { display:flex; justify-content: space-between; gap: 16px; padding: 4px 0; }
      .status { font-size: 12px; color: #666; white-space: nowrap; }
      .action { font-size: 12px; white-space: nowrap; }
      .toolbar { margin: 10px 0 15px; display:flex; gap: 12px; }
      .btn { display:inline-block; padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
      .btn:hover { background: #f0f0f0; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Correction de Tokens par exemple</h1>
        {% if username %}
          <div class="username">Utilisateur : {{ username }}</div>
        {% endif %}
      </div>

      <h2>Liste des NUM_INCLUSION</h2>
      <p>(Cliquer sur un identifiant pour ouvrir la fiche patiente.)</p>
      <div class="toolbar">
        <a class="btn" href="{{ url_for('export_all_patients') }}">Export total (JSONL)</a>
        <a class="btn" href="{{ url_for('export_all_patients') }}?zip=1">Export total (ZIP)</a>
      </div>

      <div class="num-list">
        {% for p in patients %}
            <div class="row">
                <div>
                    <a href="{{ url_for('patient', num_inclusion=p['id_patiente']) }}">{{ p['id_patiente'] }}</a>
                </div>

                <div class="status">
                    {{ p['status_texte'] }}
                    {% if p['validation_statut'] %}
                    — validation: {{ p['validation_statut'] }}
                    {% endif %}
                </div>

                <div class="action">
                    <a href="{{ url_for('export_patient', num_inclusion=p['id_patiente']) }}">Export JSON</a>
                </div>
                </div>
        {% endfor %}
      </div>
    </div>
  </body>
</html>
